/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Scala library project to get you started.
 * For more details take a look at the Scala plugin chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.4.1/userguide/scala_plugin.html
 */

plugins {
    // Apply the scala plugin to add support for Scala
    id 'scala'
    id 'application'
}

ext {
    scalaVersion = "2.11.12"
    scalaShortVersion = "2.11"
    junitVersion = "4.12"
    jacksonVersion = "2.6.5"
    scallopsVersion = "3.4.0"
}

version = "0.1"

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

dependencies {
    // Use Scala 2.12 in our library project
    implementation "org.scala-lang:scala-library:${scalaVersion}"
    implementation "com.fasterxml.jackson.module:jackson-module-scala_${scalaShortVersion}:${jacksonVersion}"
    implementation "org.rogach:scallop_${scalaShortVersion}:${scallopsVersion}"

    // Use Scalatest for testing our library
    testImplementation "junit:junit:${junitVersion}"
    testImplementation "org.scalatest:scalatest_${scalaShortVersion}:3.0.5"

    // Need scala-xml at test runtime
    testRuntimeOnly "org.scala-lang.modules:scala-xml_${scalaShortVersion}:1.1.1"
}

task fatJar(type: Jar) {
    doFirst{println "building fat jar"}
    baseName = project.name
    classifier = "fat"
    from {
        configurations.default.collect { it.isDirectory() ? it : zipTree(it) }
    }
    with jar
    manifest {
        attributes 'Main-Class' : 'org.oclc.hadoop.elastic.utils.job.BulkGenerator'
    }
}

application {
    mainClassName = 'org.oclc.hadoop.elastic.utils.job.BulkGenerator'
}
run {
    standardInput = System.in
}

test {
    testLogging {
        events "passed", "skipped", "failed"
//        showStandardStreams = true
    }
}

jar {
    finalizedBy{
        fatJar
    }
}